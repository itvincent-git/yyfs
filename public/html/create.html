<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title></title>
<script type="text/javascript" src="../js/jquery-1.7.min.js"></script>
<script type="text/javascript" src="../js/yyapi-1.1.js"></script>
<!-- <link type="text/css" rel="stylesheet" href="../../js/udbsdk/layerclose/layerclose.css"/> -->
<style type="text/css">

</style>
<script type="text/javascript">
var src_uid, tar_uid, cid;
$(function(){
	yy.channel.userListPopMenu.setPopMenu('贴纸条');

	yy.channel.userListPopMenu.addEventListener(IYYChannelUserListPopMenu.CLICKED,onClicked);
	
	//$('.create').after("getUserInfo=" + yy.user.getUserInfo('339959').name);
	cid = yy.channel.getCurrentChannelInfo().longId;
	
	function onClicked(eventData)
	{	
		$('.nick').val(yy.user.getUserInfo(eventData.uid).name);		
		tar_uid = eventData.uid;		
		//cid = eventData.cid;		
		//$('.create').after('用户'+eventData.uid+"菜单被点击,当前频道"+eventData.cid);
	}

	$('.create').click(function(){		
		var content = $('#content').val();
		src_uid = yy.user.getCurrentUserInfo().uid;		
		$.ajax({dataType : 'json', type : 'POST', url : '/create', data : {src_uid : src_uid, content : content, tar_uid : tar_uid, cid : cid }, cache : false, timeout : 10000, contentType: "application/x-www-form-urlencoded; charset=UTF-8",
			success : function(data){
				//$('.create').after( typeof data);
				if(data.result == 0){
					$('.create').after('<div>已经悄悄地贴在了他的身上</div>');
				}else{
					$('.create').after('<div>服务器出错</div>');
				}
			}
			,error : function(){
				$('.create').after('<div>服务器出错</div>');
			}
		});
	});
	
	$('.nick').keyup(function(e){
		var key = e.which;
		window.textTimeout = setTimeout(function(){
			if(window.textTimeout) clearTimeout(window.textTimeout);
			window.yyid = $(this).val();
			queryYYInfo();
		}, 200);
	});
	
	function queryYYInfo(){
		
	}
});
</script>
</head>
<body>
<h1>还记得童年时给前桌同学背后贴过的纸条吗？</h1>
<h3>去点击频道列表中，用户右键菜单里的“应用互动” -> “贴纸条”吧</h3>
<label for="nick">你想贴的人：</label><input type="text" id="nick" class="nick"/>
<p/>
<label for="content">内容...</label><textarea id="content" name="content">最多输入20个字</textarea>
<p/>
<input class="create" type="button" value="贴上去"/>	
</body>
</html>
